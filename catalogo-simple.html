<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo - Teste</title>
</head>
<body>
    <h1>Cat√°logo de Produtos</h1>
    <div id="products"></div>
    
    <script>
        console.log('üîÑ Script iniciado');
        
        const API_BASE = 'http://localhost:8000';
        let productsData = [];
        let sessionId = null;
        
        function getSessionIdFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('sessao_id');
        }
        
        async function loadSession() {
            console.log('üîÑ loadSession() iniciada');
            sessionId = getSessionIdFromURL();
            console.log('üÜî Session ID:', sessionId);
            
            if (!sessionId) {
                console.log('‚ö†Ô∏è Sem session ID, usando produtos padr√£o');
                return;
            }
            
            try {
                console.log('üì° Fazendo fetch para:', `${API_BASE}/api/produtos/${sessionId}`);
                const res = await fetch(`${API_BASE}/api/produtos/${sessionId}`);
                
                if (!res.ok) {
                    console.error('‚ùå Resposta n√£o OK:', res.status, res.statusText);
                    return;
                }
                
                const data = await res.json();
                console.log('üì¶ Dados recebidos:', data);
                
                // Limpar produtos existentes
                productsData.splice(0, productsData.length);
                
                // Adicionar produtos da sess√£o
                data.produtos.forEach(p => {
                    productsData.push({
                        id: String(p.id),
                        name: p.descricao,
                        description: p.apresentacao || p.categoria || p.descricao,
                        price: Number(p.preco),
                        imageUrl: p.imagem_url || (API_BASE + '/public/padrao.png')
                    });
                });
                
                console.log('‚úÖ Produtos carregados:', productsData.length);
                
            } catch (e) {
                console.error('‚ùå Falha ao carregar sess√£o:', e);
            }
        }
        
        function renderProducts() {
            console.log('üîÑ renderProducts() chamada');
            const container = document.getElementById('products');
            
            if (!container) {
                console.error('‚ùå Container n√£o encontrado');
                return;
            }
            
            console.log('üì¶ productsData:', productsData.length, 'produtos');
            
            if (productsData.length === 0) {
                container.innerHTML = '<p>Nenhum produto encontrado</p>';
                return;
            }
            
            container.innerHTML = productsData.map(product => `
                <div style="border: 1px solid #ccc; padding: 10px; margin: 10px;">
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    <p>Pre√ßo: R$ ${product.price.toFixed(2)}</p>
                    <img src="${product.imageUrl}" alt="${product.name}" style="max-width: 100px;">
                </div>
            `).join('');
            
            console.log('‚úÖ Produtos renderizados');
        }
        
        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üîÑ DOM carregado');
            await loadSession();
            renderProducts();
        });
    </script>
</body>
</html>