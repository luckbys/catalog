<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hakim Farma - Sua Farm√°cia Online</title>
    
    <!-- Performance optimizations -->
    <meta name="theme-color" content="#10b981">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>
    
    <!-- Tailwind CSS - Local Build -->
    <link rel="stylesheet" href="./public/styles.css">
    <link rel="stylesheet" href="./public/mobile.css">
    
    <!-- Lottie Animation Library -->
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            line-height: 1.6;
        }
        
        /* Typography Scale for Mobile */
        h1, .text-4xl {
            font-size: 2.25rem;
            line-height: 1.2;
            font-weight: 700;
        }
        
        h2, .text-3xl {
            font-size: 1.875rem;
            line-height: 1.3;
            font-weight: 600;
        }
        
        h3, .text-2xl {
            font-size: 1.5rem;
            line-height: 1.4;
            font-weight: 600;
        }
        
        h4, .text-xl {
            font-size: 1.25rem;
            line-height: 1.4;
            font-weight: 500;
        }
        
        h5, .text-lg {
            font-size: 1.125rem;
            line-height: 1.5;
            font-weight: 500;
        }
        
        p, .text-base {
            font-size: 1rem;
            line-height: 1.6;
            font-weight: 400;
        }
        
        .text-sm {
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .text-xs {
            font-size: 0.75rem;
            line-height: 1.4;
        }
        
        .product-card, .cart {
            transition: all 0.3s ease-in-out;
        }
        #deliveryModal.flex {
            display: flex;
        }
        .header-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }
        .logo-glow {
            filter: drop-shadow(0 2px 8px rgba(34, 197, 94, 0.2));
        }
        .search-enhanced {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }
        .search-enhanced:focus {
            border-color: #10b981;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.15), 0 0 0 3px rgba(16, 185, 129, 0.1);
            transform: translateY(-1px);
        }
        .cart-button-enhanced {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3), 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .cart-button-enhanced:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4), 0 4px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        .breadcrumb-enhanced {
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.05) 0%, rgba(34, 197, 94, 0.02) 100%);
            border-radius: 8px;
            padding: 12px 16px;
            border: 1px solid rgba(16, 185, 129, 0.1);
        }
        .mobile-search-toggle {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            transition: all 0.3s ease;
        }
        .mobile-search-toggle:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            transform: scale(1.05);
        }
        
        .mobile-menu-toggle {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            transition: all 0.3s ease;
        }
        
        .mobile-menu-toggle:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            transform: scale(1.05);
        }
        
        /* Mobile Menu Styles */
        .mobile-menu-open {
            transform: translateX(0) !important;
        }
        
        .mobile-overlay-show {
            display: block !important;
            opacity: 1 !important;
        }
        
        /* Estilos do Carrossel de Banners */
        .banner-carousel-section {
            position: relative;
            z-index: 10;
        }
        
        .banner-slide {
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .banner-slide.active {
            opacity: 1;
            transform: translateX(0);
        }
        
        .banner-slide.prev {
            transform: translateX(-100%);
        }
        
        /* Anima√ß√µes de Remo√ß√£o de Itens do Carrinho */
        .cart-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }
        
        .cart-item-removing {
            opacity: 0;
            transform: translateX(20px) scale(0.95);
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            margin-bottom: 0;
            overflow: hidden;
        }
        
        .cart-item-error {
            animation: shake 0.5s ease-in-out;
            border: 2px solid #ef4444;
            background-color: #fef2f2;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Estilos do Badge do Toast */
        .toast-badge-enhanced {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%) !important;
            color: #92400e !important;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 
                0 4px 12px rgba(251, 191, 36, 0.4), 
                inset 0 1px 0 rgba(255,255,255,0.2),
                0 0 0 0 rgba(251, 191, 36, 0.6);
            animation: badgePulse 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        .toast-badge-enhanced::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: badgeShine 3s ease-in-out infinite;
        }
        
        .toast-badge-enhanced:hover {
            transform: scale(1.1) !important;
            box-shadow: 
                0 6px 16px rgba(251, 191, 36, 0.5), 
                inset 0 1px 0 rgba(255,255,255,0.3),
                0 0 20px rgba(251, 191, 36, 0.4);
        }
        
        @keyframes badgePulse {
            0%, 100% { 
                box-shadow: 
                    0 4px 12px rgba(251, 191, 36, 0.4), 
                    inset 0 1px 0 rgba(255,255,255,0.2),
                    0 0 0 0 rgba(251, 191, 36, 0.6);
            }
            50% { 
                box-shadow: 
                    0 4px 12px rgba(251, 191, 36, 0.4), 
                    inset 0 1px 0 rgba(255,255,255,0.2),
                    0 0 0 8px rgba(251, 191, 36, 0.1);
            }
        }
        
        @keyframes badgeShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        }
        /* Estabilidade mobile para container da anima√ß√£o de sucesso */
        .lottie-stable-container {
            position: relative;
            display: inline-block;
            overflow: visible;
            will-change: auto;
        }
        
        /* Toast de Erro */
        .error-toast {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: 1px solid #dc2626;
        }
        
        /* Bloqueio de intera√ß√£o do conte√∫do quando o modal est√° aberto */
        body.modal-open #mainHeader,
        body.modal-open .banner-carousel-section,
        body.modal-open #bannerCarousel,
        body.modal-open #cartDrawer,
        body.modal-open #cartOverlay,
        body.modal-open main,
        body.modal-open .container {
            pointer-events: none !important;
        }
        
        @media (max-width: 768px) {
            /* Mobile Typography Adjustments */
            h1, .text-4xl {
                font-size: 1.875rem;
                line-height: 1.2;
            }
            
            h2, .text-3xl {
                font-size: 1.5rem;
                line-height: 1.3;
            }
            
            h3, .text-2xl {
                font-size: 1.25rem;
                line-height: 1.4;
            }
            
            h4, .text-xl {
                font-size: 1.125rem;
                line-height: 1.4;
            }
            
            h5, .text-lg {
                font-size: 1rem;
                line-height: 1.5;
            }
            
            p, .text-base {
                font-size: 0.9rem;
                line-height: 1.6;
            }
            
            .text-sm {
                font-size: 0.8rem;
            }
            
            /* Banner specific typography */
            .banner-slide {
                padding: 1.5rem !important;
            }
            
            .banner-slide h3 {
                font-size: 1.75rem !important;
                line-height: 1.2 !important;
            }
            
            .banner-slide p {
                font-size: 0.95rem !important;
                margin-bottom: 1rem !important;
            }
            
            /* Mobile Typography */
            body {
                font-size: 16px; /* Prevent zoom on iOS */
            }
            
            /* Mobile spacing and layout */
            .container {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            
            /* Touch-friendly buttons */
            button, .touch-manipulation {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Mobile product cards */
            .product-card {
                margin-bottom: 0.75rem;
            }
            
            .product-card img {
                height: 10rem;
            }
            
            /* Mobile header adjustments */
            .header-gradient {
                padding: 0.75rem 0;
            }
            
            /* Mobile search bar */
            .search-bar-enhanced {
                font-size: 0.875rem;
            }
            
            /* Mobile cart drawer */
            #cartDrawer {
                width: 100vw;
                max-width: none;
            }
            
            /* Line clamp utility for mobile */
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
        }
        
        /* Small mobile devices */
        @media (max-width: 480px) {
            .banner-carousel-section {
                padding: 0.5rem 0;
            }
            
            #bannerCarousel {
                height: 11rem;
            }
            
            .product-card {
                border-radius: 0.75rem;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
            
            /* Melhor controle das imagens no mobile */
            .product-img-wrapper {
                position: relative;
                width: 100%;
                aspect-ratio: 1 / 1; /* Voltando para formato quadrado para melhor aproveitamento */
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                overflow: hidden;
                border-radius: 0.5rem;
                padding: 0; /* Removendo padding completamente */
                margin-bottom: 0.5rem; /* Reduzindo margin */
                display: flex; /* Adicionando flexbox para centraliza√ß√£o */
                align-items: center; /* Centraliza√ß√£o vertical */
                justify-content: center; /* Centraliza√ß√£o horizontal */
            }
            
            .product-card img,
            .product-img {
                width: 100%;
                height: 100%;
                object-fit: contain; /* Mudando para contain para mostrar a imagem completa */
                object-position: center;
                border-radius: 0.5rem;
                background: #ffffff;
                padding: 0; /* Removendo padding completamente */
                transition: transform 0.2s ease;
            }
            
            .product-card:hover img,
            .product-card:hover .product-img {
                transform: scale(1.02);
            }
            
            /* Smaller text on very small screens */
            .text-xl {
                font-size: 1.125rem;
            }
            
            .text-lg {
                font-size: 1rem;
            }
            
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
        }
        
        /* Tablet adjustments */
        @media (min-width: 481px) and (max-width: 768px) {
            .product-img-wrapper {
                position: relative;
                width: 100%;
                aspect-ratio: 4 / 3; /* Formato mais retangular para tablets */
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                overflow: hidden;
                border-radius: 0.75rem;
                padding: 6px; /* Reduzido de 12px para 6px */
                margin-bottom: 1rem;
                display: flex; /* Adicionando flexbox para centraliza√ß√£o */
                align-items: center; /* Centraliza√ß√£o vertical */
                justify-content: center; /* Centraliza√ß√£o horizontal */
            }
            
            .product-card img,
            .product-img {
                width: 100%;
                height: 100%;
                object-fit: cover; /* Mudado de contain para cover */
                object-position: center;
                border-radius: 0.5rem;
                background: #ffffff;
                padding: 3px; /* Reduzido de 6px para 3px */
                transition: transform 0.2s ease;
            }
            
            .product-card:hover img,
            .product-card:hover .product-img {
                transform: scale(1.03);
            }
        }
        
        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .product-img-wrapper {
                position: relative;
                width: 100%;
                aspect-ratio: 3 / 2; /* Formato landscape para tablets maiores */
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                overflow: hidden;
                border-radius: 1rem;
                padding: 8px; /* Reduzido de 16px para 8px */
                margin-bottom: 1.25rem;
                display: flex; /* Adicionando flexbox para centraliza√ß√£o */
                align-items: center; /* Centraliza√ß√£o vertical */
                justify-content: center; /* Centraliza√ß√£o horizontal */
            }
            
            .product-card img,
            .product-img {
                width: 100%;
                height: 100%;
                object-fit: contain; /* Mudando para contain para mostrar imagem completa */
                object-position: center;
                border-radius: 0.75rem;
                background: #ffffff;
                padding: 4px; /* Reduzido de 8px para 4px */
                transition: transform 0.3s ease;
            }
            
            .product-card:hover img,
            .product-card:hover .product-img {
                transform: scale(1.05);
            }
        }
            
            /* Touch-friendly buttons */
            button, .btn, a[role="button"] {
                min-height: 44px;
                min-width: 44px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Touch-friendly inputs */
            input, select, textarea {
                min-height: 44px;
                font-size: 16px; /* Prevent zoom on iOS */
                touch-action: manipulation;
            }
            
            /* Estilos gerais para imagens de produtos */
        .product-img-wrapper {
            position: relative;
            width: 100%;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .product-img-wrapper.loaded {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .product-img-wrapper:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .product-img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Mudado de contain para cover */
            object-position: center;
            background: #ffffff;
            transition: transform 0.3s ease;
        }
        
        /* Desktop styles */
        @media (min-width: 1025px) {
            .product-img-wrapper {
                aspect-ratio: 1 / 1; /* Quadrado para desktop */
                border-radius: 1.25rem;
                padding: 10px; /* Reduzido de 20px para 10px */
                margin-bottom: 1.5rem;
                display: flex; /* Adicionando flexbox para centraliza√ß√£o */
                align-items: center; /* Centraliza√ß√£o vertical */
                justify-content: center; /* Centraliza√ß√£o horizontal */
            }
            
            .product-img {
                border-radius: 1rem;
                padding: 6px; /* Reduzido de 12px para 6px */
            }
            
            .product-card:hover .product-img {
                transform: scale(1.08);
            }
        }
            .product-card {
                cursor: pointer;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            
            .product-card:active {
                transform: scale(0.98);
            }
            
            /* Touch-friendly carousel controls */
            .carousel-prev, .carousel-next {
                min-height: 44px;
                min-width: 44px;
                padding: 12px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Touch-friendly mobile menu items */
            .mobile-menu-item {
                min-height: 48px;
                padding: 12px 16px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Improved scrolling for mobile */
            .mobile-menu-sidebar {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: contain;
            }
            
            /* Touch-friendly cart buttons */
            .cart-btn, .quantity-btn {
                min-height: 44px;
                min-width: 44px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Mobile Toast Optimizations */
            #toast {
                max-width: calc(100vw - 32px);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                /* Evitar conflito com teclado virtual */
                bottom: max(16px, env(safe-area-inset-bottom, 16px));
                /* Garantir que n√£o seja coberto por navega√ß√£o m√≥vel */
                margin-bottom: env(keyboard-inset-height, 0px);
            }
            
            /* Ajuste para quando o teclado virtual est√° ativo */
            @supports (height: 100dvh) {
                #toast {
                    bottom: max(16px, calc(100dvh - 100vh + 16px));
                }
            }
            
            #toast button {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            #toast button:active {
                transform: scale(0.95);
            }
            
            /* Anima√ß√µes otimizadas para mobile */
            @media (prefers-reduced-motion: no-preference) {
                #toast {
                    transition: opacity 0.3s ease-out, transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
                }
                
                #toast button {
                    transition: transform 0.15s ease-out, box-shadow 0.15s ease-out;
                }
            }
            
            /* Reduzir anima√ß√µes para usu√°rios que preferem menos movimento */
            @media (prefers-reduced-motion: reduce) {
                #toast {
                    transition: opacity 0.2s ease-out;
                }
                
                #toast button {
                    transition: none;
                }
            }

            /* Mobile spacing */
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            /* Mobile header adjustments */
            .header-gradient {
                padding-bottom: 0;
            }
        

        /* Small mobile devices */
        @media (max-width: 480px) {
            .banner-carousel-section {
                padding: 0.5rem 0;
            }
            
            #bannerCarousel {
                height: 11rem;
            }
            
            .product-card {
                border-radius: 0.5rem;
            }
            
            .product-card img {
                height: 9rem;
            }
            
            /* Smaller text on very small screens */
            .text-xl {
                font-size: 1.125rem;
            }
            
            .text-lg {
                font-size: 1rem;
            }
            
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
        }
        
        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .product-card img {
                height: 12rem;
            }
            
            #bannerCarousel {
                height: 18rem;
            }
        }
        
        @media (max-width: 640px) {
            /* Extra small screens typography */
            h1, .text-4xl {
                font-size: 1.5rem;
                line-height: 1.2;
            }
            
            h2, .text-3xl {
                font-size: 1.25rem;
                line-height: 1.3;
            }
            
            h3, .text-2xl {
                font-size: 1.125rem;
                line-height: 1.4;
            }
            
            h4, .text-xl {
                font-size: 1rem;
                line-height: 1.4;
            }
            
            p, .text-base {
                font-size: 0.875rem;
                line-height: 1.6;
            }
            
            /* Banner specific adjustments */
            .banner-slide h3 {
                font-size: 1.5rem !important;
            }
            
            .banner-slide p {
                font-size: 0.875rem !important;
            }
        }
        
        @media (max-width: 480px) {
            /* Very small screens */
            .banner-slide {
                padding: 1rem !important;
            }
            
            .banner-slide h3 {
                font-size: 1.25rem !important;
            }
        }
        
        /* Anima√ß√µes suaves para transi√ß√µes */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .slide-in-right {
            animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .slide-in-left {
            animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Utility: hide scrollbar for scrollable chips */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }


        /* Small mobile devices */
        @media (max-width: 480px) {
            .banner-carousel-section {
                padding: 0.5rem 0;
            }
            
            #bannerCarousel {
                height: 11rem;
            }
            
            .product-card {
                border-radius: 0.5rem;
            }
            
            .product-card img {
                height: 9rem;
            }
            
            /* Smaller text on very small screens */
            .text-xl {
                font-size: 1.125rem;
            }
            
            .text-lg {
                font-size: 1rem;
            }
            
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
        }
        
        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .product-card img {
                height: 12rem;
            }
            
            #bannerCarousel {
                height: 18rem;
            }
        }
        
        @media (max-width: 640px) {
            /* Extra small screens typography */
            h1, .text-4xl {
                font-size: 1.5rem;
                line-height: 1.2;
            }
            
            h2, .text-3xl {
                font-size: 1.25rem;
                line-height: 1.3;
            }
            
            h3, .text-2xl {
                font-size: 1.125rem;
                line-height: 1.4;
            }
            
            h4, .text-xl {
                font-size: 1rem;
                line-height: 1.4;
            }
            
            p, .text-base {
                font-size: 0.875rem;
                line-height: 1.6;
            }
            
            /* Banner specific adjustments */
            .banner-slide h3 {
                font-size: 1.5rem !important;
            }
            
            .banner-slide p {
                font-size: 0.875rem !important;
            }
        }
        
        @media (max-width: 480px) {
            /* Very small screens */
            .banner-slide {
                padding: 1rem !important;
            }
            
            .banner-slide h3 {
                font-size: 1.25rem !important;
            }
        }
        
        /* Anima√ß√µes suaves para transi√ß√µes */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .slide-in-right {
            animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .slide-in-left {
            animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Utility: hide scrollbar for scrollable chips */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Small mobile devices */
        @media (max-width: 480px) {
            .banner-carousel-section {
                padding: 0.5rem 0;
            }
            
            #bannerCarousel {
                height: 11rem;
            }
            
            .product-card {
                border-radius: 0.5rem;
            }
            
            .product-card img {
                height: 9rem;
            }
            
            /* Smaller text on very small screens */
            .text-xl {
                font-size: 1.125rem;
            }
            
            .text-lg {
                font-size: 1rem;
            }
            
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
        }
        
        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .product-card img {
                height: 12rem;
            }
            
            #bannerCarousel {
                height: 18rem;
            }
        }
        
        @media (max-width: 640px) {
            /* Extra small screens typography */
            h1, .text-4xl {
                font-size: 1.5rem;
                line-height: 1.2;
            }
            
            h2, .text-3xl {
                font-size: 1.25rem;
                line-height: 1.3;
            }
            
            h3, .text-2xl {
                font-size: 1.125rem;
                line-height: 1.4;
            }
            
            h4, .text-xl {
                font-size: 1rem;
                line-height: 1.4;
            }
            
            p, .text-base {
                font-size: 0.875rem;
                line-height: 1.6;
            }
            
            /* Banner specific adjustments */
            .banner-slide h3 {
                font-size: 1.5rem !important;
            }
            
            .banner-slide p {
                font-size: 0.875rem !important;
            }
        }
        
        @media (max-width: 480px) {
            /* Very small screens */
            .banner-slide {
                padding: 1rem !important;
            }
            
            .banner-slide h3 {
                font-size: 1.25rem !important;
            }
        }
        
        /* Anima√ß√µes suaves para transi√ß√µes */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .slide-in-right {
            animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .slide-in-left {
            animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Utility: hide scrollbar for scrollable chips */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header Marketplace -->
    <header class="header-gradient sticky top-0 z-50 transition-transform duration-300 ease-in-out header-visible" id="mainHeader">
        <div class="container mx-auto px-4 lg:px-6">
            <!-- Mobile Header -->
            <div class="flex items-center justify-between py-3 md:py-4">
                <!-- Logo -->
                <div class="flex items-center space-x-2 md:space-x-4">
                    <img src="./public/logo.png" alt="Hakim Farma" class="h-10 md:h-16 w-auto logo-glow">
                    <div class="block">
                        <h1 class="text-sm md:text-2xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">Hakim Farma</h1>
                        <p class="text-xs md:text-sm text-slate-600 font-medium hidden sm:block">Sua farm√°cia de confian√ßa</p>
                    </div>
                </div>

                <!-- Desktop Search Bar -->
                <div class="flex-1 max-w-3xl mx-8 hidden lg:block">
                    <div class="relative">
                        <input 
                            id="searchInput" 
                            type="text" 
                            placeholder="üîç Busque por medicamentos, produtos de sa√∫de, vitaminas..." 
                            class="w-full search-enhanced rounded-xl py-4 px-6 pr-14 text-slate-700 placeholder-slate-500 focus:outline-none"
                        />
                        <button class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-green-600 transition-colors p-2 rounded-lg hover:bg-green-50">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center space-x-2 md:space-x-3">
                    <!-- Mobile Search Toggle -->
                    <button id="mobileSearchToggle" class="lg:hidden p-2 md:p-3 mobile-search-toggle rounded-xl text-slate-600 hover:text-green-600 transition-all duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>

                    <!-- Cart Button -->
                    <button id="cartBtn" class="relative flex items-center space-x-2 md:space-x-3 cart-button-enhanced text-white px-3 py-2 md:px-6 md:py-3 rounded-xl font-semibold text-sm md:text-base">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" class="md:w-5 md:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <path d="M16 10a4 4 0 0 1-8 0"></path>
                        </svg>
                        <span class="hidden sm:inline">Carrinho</span>
                        <span id="cartCount" class="absolute -top-2 -right-2 bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center shadow-lg">0</span>
                    </button>
                </div>
            </div>

            <!-- Mobile Search Bar -->
            <div id="mobileSearchBar" class="lg:hidden py-4 border-b border-slate-200/60 hidden">
                <div class="relative">
                    <input 
                        id="mobileSearchInput" 
                        type="text" 
                        placeholder="üîç Busque por medicamentos, produtos..." 
                        class="w-full search-enhanced rounded-xl py-4 px-6 pr-14 text-slate-700 placeholder-slate-500 focus:outline-none text-base"
                    />
                    <button class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-green-600 transition-colors p-2 rounded-lg hover:bg-green-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Navigation/Breadcrumb -->
            <div class="py-3 md:py-4">
                <div class="breadcrumb-enhanced">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2 md:space-x-3 text-xs md:text-sm">
                            <div class="flex items-center space-x-1 md:space-x-2 text-green-600">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="md:w-5 md:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9,22 9,12 15,12 15,22"></polyline>
                                </svg>
                                <span class="font-semibold">Cat√°logo</span>
                            </div>
                            <div class="hidden sm:flex items-center space-x-2 text-slate-600">
                                <svg xmlns="http://www.w3.org/2000/svg" width="4" height="4" viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="12" cy="12" r="2"></circle>
                                </svg>
                                <span class="font-medium">Medicamentos e Produtos</span>
                            </div>
                        </div>
                        <div class="hidden md:flex items-center space-x-2 text-xs text-slate-500">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2v20m8-10H4"></path>
                            </svg>
                            <span>Entrega r√°pida e segura</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Carrossel de Banners de Promo√ß√µes -->
    <section class="banner-carousel-section bg-gradient-to-r from-slate-50 to-white py-4 md:py-6">
        <div class="container mx-auto px-3 md:px-4 lg:px-6">
            <div class="relative overflow-hidden rounded-xl md:rounded-2xl shadow-xl md:shadow-2xl">
                <!-- Carrossel Container -->
                <div id="bannerCarousel" class="relative h-48 sm:h-56 md:h-80 lg:h-96 touch-pan-y">
                    <!-- Banner 1 - Desconto Medicamentos -->
                    <div class="banner-slide active absolute inset-0 bg-gradient-to-r from-green-500 via-emerald-500 to-teal-500 flex items-center justify-between p-4 sm:p-6 md:p-8 lg:p-12">
                        <div class="text-white max-w-full sm:max-w-lg flex-1">
                            <div class="inline-block bg-white/20 backdrop-blur-sm rounded-full px-3 py-1 sm:px-4 sm:py-2 mb-2 sm:mb-4">
                                <span class="text-xs sm:text-sm font-semibold">üè∑Ô∏è SUPER OFERTA</span>
                            </div>
                            <h3 class="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold mb-2 sm:mb-4 leading-tight">
                                At√© <span class="text-yellow-300">50% OFF</span><br class="hidden sm:block">
                                <span class="sm:hidden"> </span>em Medicamentos
                            </h3>
                            <p class="text-sm sm:text-base md:text-lg mb-3 sm:mb-6 text-green-100 leading-relaxed">
                                Aproveite descontos incr√≠veis em medicamentos essenciais
                            </p>
                        </div>
                        <div class="hidden lg:block flex-shrink-0 ml-4">
                            <div class="w-32 h-32 xl:w-48 xl:h-48 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" class="xl:w-20 xl:h-20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                                    <path d="M4.5 16.5c-1.5 1.5-1.5 4.5 0 6s4.5 1.5 6 0c.5-.5 1.5-1 2.5-1s2 .5 2.5 1c1.5 1.5 4.5 1.5 6 0s1.5-4.5 0-6c-.5-.5-1-1.5-1-2.5s.5-2 1-2.5c1.5-1.5 1.5-4.5 0-6s-4.5-1.5-6 0c-.5.5-1.5 1-2.5 1s-2-.5-2.5-1c-1.5-1.5-4.5-1.5-6 0s-1.5 4.5 0 6c.5.5 1 1.5 1 2.5s-.5 2-1 2.5z"></path>
                                    <path d="M9 12l2 2 4-4"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Banner 2 - Vitaminas -->
                    <div class="banner-slide absolute inset-0 bg-gradient-to-r from-purple-500 via-pink-500 to-rose-500 flex items-center justify-between p-4 sm:p-6 md:p-8 lg:p-12">
                        <div class="text-white max-w-full sm:max-w-lg flex-1">
                            <div class="inline-block bg-white/20 backdrop-blur-sm rounded-full px-3 py-1 sm:px-4 sm:py-2 mb-2 sm:mb-4">
                                <span class="text-xs sm:text-sm font-semibold">üíä VITAMINAS</span>
                            </div>
                            <h3 class="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold mb-2 sm:mb-4 leading-tight">
                                <span class="text-yellow-300">Vitaminas</span><br class="hidden sm:block">
                                <span class="sm:hidden"> </span>e Suplementos
                            </h3>
                            <p class="text-sm sm:text-base md:text-lg mb-3 sm:mb-6 text-purple-100 leading-relaxed">
                                Cuide da sua sa√∫de com vitaminas e suplementos
                            </p>
                        </div>
                        <div class="hidden lg:block flex-shrink-0 ml-4">
                            <div class="w-32 h-32 xl:w-48 xl:h-48 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" class="xl:w-20 xl:h-20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="9" cy="9" r="2"></circle>
                                    <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Banner 3 - Entrega Gr√°tis -->
                    <div class="banner-slide absolute inset-0 bg-gradient-to-r from-blue-500 via-cyan-500 to-teal-500 flex items-center justify-between p-4 sm:p-6 md:p-8 lg:p-12">
                        <div class="text-white max-w-full sm:max-w-lg flex-1">
                            <div class="inline-block bg-white/20 backdrop-blur-sm rounded-full px-3 py-1 sm:px-4 sm:py-2 mb-2 sm:mb-4">
                                <span class="text-xs sm:text-sm font-semibold">üöö FRETE GR√ÅTIS</span>
                            </div>
                            <h3 class="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold mb-2 sm:mb-4 leading-tight">
                                <span class="text-yellow-300">Entrega Gr√°tis</span><br class="hidden sm:block">
                                <span class="sm:hidden"> </span>em Compras Acima de R$ 99
                            </h3>
                            <p class="text-sm sm:text-base md:text-lg mb-3 sm:mb-6 text-blue-100 leading-relaxed">
                                Receba seus medicamentos sem pagar frete
                            </p>
                        </div>
                        <div class="hidden lg:block flex-shrink-0 ml-4">
                            <div class="w-32 h-32 xl:w-48 xl:h-48 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" class="xl:w-20 xl:h-20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-white">
                                    <rect x="1" y="3" width="15" height="13"></rect>
                                    <polygon points="16,8 20,8 23,11 23,16 16,16 16,8"></polygon>
                                    <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                    <circle cx="18.5" cy="18.5" r="2.5"></circle>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container mx-auto p-4 md:p-8">
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8">
            <!-- Coluna de Produtos -->
            <div class="lg:col-span-3">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 md:mb-6 gap-3 sm:gap-0">
                    <h2 class="text-xl md:text-2xl font-semibold text-slate-800">Produtos Dispon√≠veis</h2>
                    <div class="flex items-center space-x-2 text-xs sm:text-sm text-slate-600">
                        <span id="productCount">0 produtos encontrados</span>
                    </div>
                </div>
                <div id="productList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 md:gap-6">
                    <!-- Os produtos ser√£o inseridos aqui pelo JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <!-- Cart Drawer -->
    <div id="cartDrawer" class="fixed top-0 right-0 h-full w-full max-w-sm bg-white shadow-2xl z-[100] transform translate-x-full transition-transform duration-300 ease-in-out flex flex-col">
        <div class="flex justify-between items-center p-4 border-b">
            <h2 class="text-2xl font-semibold flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                Seu Pedido
            </h2>
            <div class="flex items-center space-x-2">
                <!-- Clear Cart Icon Button -->
                <button id="clearCartBtn" class="p-2 rounded-full hover:bg-red-50 text-red-500 hover:text-red-600 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent" title="Limpar Carrinho" aria-label="Limpar Carrinho">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3,6 5,6 21,6"></polyline>
                        <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </button>
                <!-- Close Cart Button -->
                <button id="closeCartBtn" class="p-2 rounded-full hover:bg-slate-100">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
        </div>
        <div id="cartItems" class="flex-grow overflow-y-auto p-4">
            <p id="emptyCartMessage" class="text-slate-500 text-center py-4">Seu carrinho est√° vazio.</p>
            <div id="cartItemsList" class="space-y-4"></div>
        </div>
        <div class="p-4 border-t mt-auto bg-white">
            <div class="flex justify-between items-center text-xl font-bold">
                <span>Total:</span>
                <span id="cartTotal">R$ 0,00</span>
            </div>
            
            <!-- Bot√µes de a√ß√£o do carrinho -->
            <div class="mt-4 space-y-2">
                <!-- Bot√£o Finalizar Pedido -->
                <button id="openDeliveryModalBtn" class="w-full bg-green-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                    Finalizar Pedido
                </button>
            </div>
        </div>
    </div>
    
    <!-- Delivery Details Modal -->
    <div id="deliveryModal" role="dialog" aria-modal="true" class="fixed inset-0 bg-black bg-opacity-60 z-[102] hidden items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto my-4">
            <h2 class="text-2xl font-bold mb-4">Informa√ß√µes para Entrega</h2>
            <form id="deliveryForm">
                <div class="mb-4">
                    <label for="customerName" class="block text-slate-700 text-sm font-bold mb-2">Nome Completo</label>
                    <input type="text" id="customerName" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <div>
                        <label for="customerCep" class="block text-slate-700 text-sm font-bold mb-2">CEP</label>
                         <div class="flex items-center">
                            <input type="text" id="customerCep" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline" required maxlength="9" inputmode="numeric" pattern="\d{5}-?\d{3}" title="CEP deve ter 8 d√≠gitos" autocomplete="postal-code">
                            <span id="cep-loading" class="ml-2 text-sm hidden">Buscando...</span>
                        </div>
                    </div>
                     <div>
                        <label for="customerStreet" class="block text-slate-700 text-sm font-bold mb-2">Rua / Logradouro</label>
                        <input type="text" id="customerStreet" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline bg-slate-100" readonly required>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="customerNumber" class="block text-slate-700 text-sm font-bold mb-2">N√∫mero</label>
                        <input type="text" id="customerNumber" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline" required inputmode="numeric" pattern="\d+" title="Informe apenas n√∫meros">
                    </div>
                    <div>
                        <label for="customerComplement" class="block text-slate-700 text-sm font-bold mb-2">Complemento <span class="text-xs font-light">(Opcional)</span></label>
                        <input type="text" id="customerComplement" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Apto, Bloco, Casa">
                    </div>
                </div>
                 <div class="grid grid-cols-1 gap-4 mb-6">
                    <div>
                        <label for="customerNeighborhood" class="block text-slate-700 text-sm font-bold mb-2">Bairro</label>
                        <input type="text" id="customerNeighborhood" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline bg-slate-100" readonly required>
                    </div>
                     <div>
                        <label for="customerCity" class="block text-slate-700 text-sm font-bold mb-2">Cidade</label>
                        <input type="text" id="customerCity" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline bg-slate-100" readonly required>
                    </div>
                     <div>
                        <label for="customerState" class="block text-slate-700 text-sm font-bold mb-2">Estado</label>
                        <input type="text" id="customerState" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline bg-slate-100" readonly required>
                    </div>
                </div>
                
                <!-- Forma de Pagamento -->
                <div class="mb-6">
                    <label class="block text-slate-700 text-sm font-bold mb-3">Forma de Pagamento</label>
                    <div class="space-y-3">
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="radio" name="paymentMethod" value="dinheiro" class="mr-3 text-blue-600" required>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-green-600"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                                <span class="font-medium">Dinheiro</span>
                            </div>
                        </label>
                        
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="radio" name="paymentMethod" value="pix" class="mr-3 text-blue-600" required>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-blue-600"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="m9 9 5 5v-5h-5"></path></svg>
                                <span class="font-medium">PIX</span>
                            </div>
                        </label>
                        
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="radio" name="paymentMethod" value="cartao_credito" class="mr-3 text-blue-600" required>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-purple-600"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                                <span class="font-medium">Cart√£o de Cr√©dito</span>
                            </div>
                        </label>
                        
                        <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="radio" name="paymentMethod" value="cartao_debito" class="mr-3 text-blue-600" required>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-orange-600"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                                <span class="font-medium">Cart√£o de D√©bito</span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row items-center justify-end gap-4 mt-6">
                    <button type="button" id="cancelDeliveryBtn" class="w-full sm:w-auto bg-slate-500 hover:bg-slate-600 text-white font-bold py-3 px-4 rounded focus:outline-none focus:shadow-outline transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded focus:outline-none focus:shadow-outline transition-colors">
                        Confirmar Pedido
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Overlay Modal (Simplified) -->
    <div id="successModal" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[9999] hidden items-center justify-center p-4" style="z-index: 2147483647;">
        <div class="bg-white rounded-2xl shadow-2xl p-6 text-center max-w-sm w-full transform scale-95 transition-all duration-300 mx-auto" style="max-width: 420px;">
            <div class="mb-4 flex justify-center">
                <img id="successCartImage" src="/public/cart.png" alt="Carrinho" class="w-16 h-16 md:w-20 md:h-20 object-contain" />
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2" id="orderNumberText">Pedido #‚Äî</h2>
            <p class="text-sm text-gray-600" id="deliveryEstimateText">Estimativa de entrega: ‚Äî</p>
            <p class="text-sm text-slate-600 mt-2" id="whatsappNoticeText">Voc√™ receber√° o resumo pelo WhatsApp em instantes</p>
            <p class="text-sm text-slate-500" id="thankYouText">Obrigado pela prefer√™ncia! üíö</p>
            <div id="successOrderSummary" class="mt-3 text-left bg-slate-50 border border-slate-200 rounded-xl p-3 hidden">
                <div class="flex justify-between text-sm">
                    <span class="text-slate-600">Itens</span>
                    <span id="summaryItemsCount" class="text-slate-800">‚Äî</span>
                </div>
                <div class="flex justify-between text-sm mt-1">
                    <span class="text-slate-600 font-medium">Total</span>
                    <span id="summaryTotal" class="text-slate-800 font-semibold">‚Äî</span>
                </div>
            </div>
            <a id="trackDeliveryLink" href="#" class="mt-4 inline-flex items-center justify-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 w-full">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M3 7h13l3 5H8l-5-5Zm0 0v10h14M10 12v5m4-5v5"/></svg>
                Acompanhar entrega
            </a>
            <button id="closeSuccessModal" class="mt-2 bg-slate-700 hover:bg-slate-800 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 w-full">
                OK
            </button>
        </div>
    </div>

    <!-- Clear Cart Confirmation Modal -->
    <div id="clearCartModal" class="fixed inset-0 bg-black bg-opacity-70 z-[103] hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-6 text-center max-w-sm w-full transform scale-95 transition-all duration-300">
            <!-- Warning Icon -->
            <div class="mb-4 flex justify-center">
                <div class="bg-red-100 rounded-full p-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                </div>
            </div>
            
            <!-- Confirmation Message -->
            <h2 class="text-xl font-bold text-gray-800 mb-2">Limpar Carrinho?</h2>
            <p class="text-gray-600 mb-6">Tem certeza que deseja remover todos os itens do seu carrinho? Esta a√ß√£o n√£o pode ser desfeita.</p>
            
            <!-- Action Buttons -->
            <div class="flex space-x-3">
                <button id="cancelClearCart" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg transition-colors duration-200">
                    Cancelar
                </button>
                <button id="confirmClearCart" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200">
                    Limpar
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay for Drawer -->
    <div id="cartOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-[99] hidden transition-opacity duration-300"></div>

    <!-- Scroll to Top FAB -->
    <button id="scrollToTopFab" class="scroll-to-top-fab" title="Voltar ao topo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 14L12 9L17 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>

    <!-- Toast de Carrinho (otimizado para mobile) -->
    <div id="toast" class="fixed bottom-4 sm:bottom-5 left-4 right-4 sm:left-1/2 sm:right-auto sm:transform sm:-translate-x-1/2 sm:max-w-md rounded-xl shadow-2xl opacity-0 translate-y-10 transition-all duration-300 ease-out z-[1001] border border-green-600/20 will-change-transform" style="background-color: #16a34a !important; color: white !important; padding: 16px 20px;">
        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4">
            <div class="flex items-center gap-2 flex-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: white !important;">
                    <path d="M20 6L9 17l-5-5"></path>
                </svg>
                <span class="font-medium text-sm sm:text-base" style="color: white !important;">Adicionado ao carrinho</span>
                <span class="toast-badge-enhanced inline-flex items-center justify-center font-bold px-3 py-1.5 rounded-full text-xs ml-auto sm:ml-2 shadow-lg transform transition-all duration-200 hover:scale-105" id="toastCartQty">0</span>
            </div>
            <button type="button" id="toastCartBtn" class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all duration-200 ease-out w-full sm:w-auto min-h-[44px] touch-manipulation will-change-transform" style="background-color: white !important; color: #166534 !important; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" aria-label="Ir para o carrinho">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #166534 !important;">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <span style="color: #166534 !important;">Ver carrinho</span>
            </button>
        </div>
    </div>

    <script>
    // --- INTEGRA√á√ÉO N8N ---
    const productsData = [
        {
            id: 'prod001',
            name: 'Dipirona S√≥dica 500mg',
            description: 'Caixa com 10 comprimidos. Analg√©sico e antit√©rmico.',
            price: 8.50,
            imageUrl: 'https://placehold.co/300x300/e0f2fe/0284c7?text=Dipirona'
        },
        {
            id: 'prod002',
            name: 'Paracetamol 750mg',
            description: 'Caixa com 20 comprimidos. Indicado para dor e febre.',
            price: 12.75,
            imageUrl: 'https://placehold.co/300x300/e0f2fe/0284c7?text=Paracetamol'
        },
        {
            id: 'prod003',
            name: 'Vitamina C Efervescente',
            description: 'Tubo com 10 comprimidos. Sabor laranja.',
            price: 15.00,
            imageUrl: 'https://placehold.co/300x300/e0f2fe/0284c7?text=Vitamina+C'
        },
        {
            id: 'prod004',
            name: 'Soro Fisiol√≥gico 0,9%',
            description: 'Frasco com 500ml. Uso nasal, inala√ß√µes e limpeza.',
            price: 6.20,
            imageUrl: 'https://placehold.co/300x300/e0f2fe/0284c7?text=Soro'
        },
        {
            id: 'prod005',
            name: '√Ålcool em Gel 70%',
            description: 'Frasco com 250ml. Antiss√©ptico para as m√£os.',
            price: 9.90,
            imageUrl: 'https://placehold.co/300x300/e0f2fe/0284c7?text=√Ålcool+Gel'
        },
        {
            id: 'prod006',
            name: 'Curativos Adesivos',
            description: 'Caixa com 35 unidades. Discretos e resistentes.',
            price: 7.80,
            imageUrl: 'https://placehold.co/300x300/e0f2fe/0284c7?text=Curativos'
        }
    ];

    let cart = {};

    const productListContainer = document.getElementById('productList');
    const cartItemsContainer = document.getElementById('cartItems');
    const cartItemsList = document.getElementById('cartItemsList');
    const cartTotalElement = document.getElementById('cartTotal');
    const emptyCartMessage = document.getElementById('emptyCartMessage');
    const openDeliveryModalBtn = document.getElementById('openDeliveryModalBtn');
    const toastElement = document.getElementById('toast');
    const cartDrawer = document.getElementById('cartDrawer');
    const cartOverlay = document.getElementById('cartOverlay');
    const cartBtn = document.getElementById('cartBtn');
    const closeCartBtn = document.getElementById('closeCartBtn');
    const cartCount = document.getElementById('cartCount');
    const deliveryModal = document.getElementById('deliveryModal');
    const deliveryForm = document.getElementById('deliveryForm');
    const cancelDeliveryBtn = document.getElementById('cancelDeliveryBtn');
    const cepInput = document.getElementById('customerCep');
    const cepLoading = document.getElementById('cep-loading');
    const mainHeader = document.getElementById('mainHeader');
    const scrollToTopFab = document.getElementById('scrollToTopFab');
    let sessionId = null;
    let sessionPhone = null;
    let lastScrollY = 0;
    let isScrollingDown = false;
    
    // Configura√ß√£o da API - ajuste para produ√ß√£o
    const API_BASE = window.location.hostname === 'localhost' 
        ? 'http://localhost:8000' 
        : window.location.origin; // Usa o mesmo dom√≠nio com proxy reverso

    function formatCurrency(value) {
        return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function debounce(fn, delay = 200) {
        let t;
        return (...args) => {
            clearTimeout(t);
            t = setTimeout(() => fn(...args), delay);
        };
    }

    function renderProducts() {
        console.log('[DEBUG] renderProducts() chamada');
        if (!productListContainer) {
            console.error('[ERROR] productListContainer nao encontrado');
            return;
        }
        
        console.log('[DEBUG] productsData:', productsData.length, 'produtos');
        
        const searchInput = document.getElementById('searchInput');
        const headerSearchInput = document.getElementById('headerSearchInput');
        const mobileSearchInput = document.getElementById('mobileSearchInput');
        
        // Pegar valor de busca de qualquer um dos campos
        let query = '';
        if (mobileSearchInput && mobileSearchInput.value) {
            query = mobileSearchInput.value.toLowerCase().trim();
            console.log('[DEBUG] Busca mobile:', query);
        } else if (searchInput && searchInput.value) {
            query = searchInput.value.toLowerCase().trim();
            console.log('[DEBUG] Busca desktop:', query);
        } else if (headerSearchInput && headerSearchInput.value) {
            query = headerSearchInput.value.toLowerCase().trim();
            console.log('[DEBUG] Busca header:', query);
        }
        
        const filtered = productsData.filter(p => {
            const tName = p.name.toLowerCase();
            const tDesc = p.description.toLowerCase();
            return tName.includes(query) || tDesc.includes(query);
        });
        
        console.log('[DEBUG] Produtos filtrados:', filtered.length);
        
        productListContainer.innerHTML = filtered.map(product => `
            <div class="product-card bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl hover:-translate-y-2 flex flex-col transition-all duration-300 border border-slate-100">
                <div class="product-img-wrapper relative">
                    <img src="${product.imageUrl}" alt="${product.name}" class="product-img w-full" loading="lazy" decoding="async" fetchpriority="low"
                         onerror="this.onerror=null; this.src='/public/padrao.png';" onload="this.closest('.product-img-wrapper')?.classList.add('loaded')">
                </div>
                <div class="p-3 sm:p-5 flex flex-col flex-grow">
                    <h3 class="text-base sm:text-lg font-bold text-slate-800 leading-tight mb-1">${product.name}</h3>
                    <p class="text-slate-600 text-xs sm:text-sm flex-grow leading-relaxed line-clamp-2 mb-3">${product.description}</p>
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 sm:gap-2">
                        <span class="text-xl sm:text-2xl font-bold text-green-600">${formatCurrency(product.price)}</span>
                        <button class="add-to-cart-btn bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold py-3 px-5 sm:px-6 rounded-xl hover:from-green-600 hover:to-emerald-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 touch-manipulation text-sm sm:text-base w-full sm:w-auto" data-id="${product.id}" aria-label="Adicionar ${product.name} ao carrinho">
                            <span class="flex items-center justify-center space-x-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="sm:w-4 sm:h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                    <path d="M16 10a4 4 0 0 1-8 0"></path>
                                </svg>
                                <span>Adicionar</span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function addToCart(productId) {
        if (cart[productId]) {
            cart[productId].quantity++;
        } else {
            const product = productsData.find(p => p.id === productId);
            if (product) {
                cart[productId] = { ...product, quantity: 1 };
            }
        }
        saveCart();
        showToast();
        renderCart();
        updateCartCounter();
    }
    
    function getCartItemCount() {
        try {
            return Object.values(cart).reduce((sum, item) => sum + (item.quantity || 0), 0);
        } catch (_) {
            return 0;
        }
    }

    // Fun√ß√µes para controlar o FAB durante o toast
    function hideFabForToast() {
        if (scrollToTopFab.classList.contains('visible')) {
            scrollToTopFab.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
            scrollToTopFab.style.opacity = '0';
            scrollToTopFab.style.visibility = 'hidden';
            scrollToTopFab.style.transform = 'translateY(10px)';
        }
    }

    function showFabAfterToast() {
        // S√≥ mostra o FAB se ele deveria estar vis√≠vel (scroll > 300px)
        if (window.scrollY > 300) {
            scrollToTopFab.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
            scrollToTopFab.style.opacity = '1';
            scrollToTopFab.style.visibility = 'visible';
            scrollToTopFab.style.transform = 'translateY(0)';
        }
    }

    function showToast() {
        const count = getCartItemCount();
        const label = count === 1 ? '1 item' : `${count} itens`;
        
        // Oculta o FAB quando o toast aparecer
        hideFabForToast();
        
        // Atualiza conte√∫do do toast com layout otimizado para mobile
        toastElement.innerHTML = `
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4">
                <div class="flex items-center gap-2 flex-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: white !important;">
                        <path d="M20 6L9 17l-5-5"></path>
                    </svg>
                    <span class="font-medium text-sm sm:text-base" style="color: white !important;">Adicionado ao carrinho</span>
                    <span class="toast-badge-enhanced inline-flex items-center justify-center font-bold px-3 py-1.5 rounded-full text-xs ml-auto sm:ml-2 shadow-lg transform transition-all duration-200 hover:scale-105">${label}</span>
                </div>
                <button type="button" class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all duration-200 ease-out w-full sm:w-auto min-h-[44px] touch-manipulation will-change-transform" style="background-color: white !important; color: #166534 !important; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" id="toastCartBtn" aria-label="Ir para o carrinho">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: #166534 !important;">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span style="color: #166534 !important;">Ver carrinho</span>
                </button>
            </div>
        `;

        const btn = toastElement.querySelector('#toastCartBtn');
        if (btn) {
            btn.addEventListener('click', () => {
                try { 
                    toastElement.classList.add('opacity-0', 'translate-y-10');
                    // Mostra o FAB novamente quando o toast for fechado pelo bot√£o
                    setTimeout(() => {
                        showFabAfterToast();
                        toggleCart();
                    }, 150); 
                } catch (_) {}
            }, { once: true });
        }

        toastElement.classList.remove('opacity-0', 'translate-y-10');
        setTimeout(() => {
            toastElement.classList.add('opacity-0', 'translate-y-10');
            // Mostra o FAB novamente quando o toast desaparecer automaticamente
            setTimeout(() => showFabAfterToast(), 300);
        }, 3500);
    }

    function updateQuantity(productId, change) {
        if (cart[productId]) {
            cart[productId].quantity += change;
            if (cart[productId].quantity <= 0) {
                delete cart[productId];
            }
            saveCart();
            renderCart();
            updateCartCounter();
        }
    }

    function saveCart() {
        try {
            localStorage.setItem('cart', JSON.stringify(cart));
        } catch (e) {}
    }
    
    function toggleCart() {
        cartDrawer.classList.toggle('translate-x-full');
        if (cartDrawer.classList.contains('translate-x-full')) {
            cartOverlay.classList.add('hidden');
            document.body.style.overflow = '';
        } else {
            cartOverlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
    }

    // Garantir fechamento expl√≠cito do drawer (evita conflito com modais)
    function closeCartDrawer() {
        if (!cartDrawer.classList.contains('translate-x-full')) {
            cartDrawer.classList.add('translate-x-full');
        }
        cartOverlay.classList.add('hidden');
        // N√£o bloquear scroll por causa do drawer quando modal abrir
        document.body.style.overflow = '';
    }

    function renderCart() {
        if (!cartItemsContainer || !cartItemsList) return;
        const cartKeys = Object.keys(cart);
        let total = 0;
        let totalItems = 0;
        const emptyMsgEl = document.getElementById('emptyCartMessage');

        if (cartKeys.length === 0) {
            emptyMsgEl && emptyMsgEl.classList.remove('hidden');
            cartItemsList.innerHTML = '';
            openDeliveryModalBtn.disabled = true;
            // Desabilitar bot√£o de limpar carrinho quando vazio
            const clearCartBtn = document.getElementById('clearCartBtn');
            if (clearCartBtn) {
                clearCartBtn.disabled = true;
            }
        } else {
            emptyMsgEl && emptyMsgEl.classList.add('hidden');
            cartItemsList.innerHTML = '';
            openDeliveryModalBtn.disabled = false;
            // Habilitar bot√£o de limpar carrinho quando h√° itens
            const clearCartBtn = document.getElementById('clearCartBtn');
            if (clearCartBtn) {
                clearCartBtn.disabled = false;
            }
        }
        
        cartKeys.forEach(key => {
            const item = cart[key];
            total += item.price * item.quantity;
            totalItems += item.quantity;

            const cartItemHTML = `
                <div class="cart-item flex justify-between items-center">
                    <div>
                        <p class="font-semibold">${item.name}</p>
                        <p class="text-sm text-slate-500">${formatCurrency(item.price)}</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="decrease-qty-btn w-8 h-8 flex items-center justify-center bg-slate-200 rounded-full font-bold hover:bg-slate-300 transition-colors" data-id="${item.id}">-</button>
                        <span class="w-8 text-center font-medium">${item.quantity}</span>
                        <button class="increase-qty-btn w-8 h-8 flex items-center justify-center bg-slate-200 rounded-full font-bold hover:bg-slate-300 transition-colors" data-id="${item.id}">+</button>
                        <button class="remove-item-btn w-8 h-8 flex items-center justify-center rounded-full text-red-600 hover:bg-red-100" data-id="${item.id}" title="Remover">√ó</button>
                    </div>
                </div>
            `;
            cartItemsList.innerHTML += cartItemHTML;
        });

        cartTotalElement.textContent = formatCurrency(total);

        // Atualizar contador do header
        if (cartCount) {
            cartCount.textContent = String(totalItems);
        }
    }
    
    function sendWhatsAppMessage(deliveryDetails) {
        const phoneNumber = sessionPhone || '5511999998888'; 
        if (Object.keys(cart).length === 0) return;

        let message = 'Ol√°! Gostaria de fazer o seguinte pedido:\n\n';
        let total = 0;

        // Adiciona produtos √† mensagem
        Object.values(cart).forEach(item => {
            message += `*${item.name}*\n`;
            message += `Quantidade: ${item.quantity}\n`;
            message += `Subtotal: ${formatCurrency(item.price * item.quantity)}\n\n`;
            total += item.price * item.quantity;
        });

        message += `*Total do Pedido: ${formatCurrency(total)}*\n\n`;
        
        // Adiciona forma de pagamento √† mensagem
        const selectedPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
        if (selectedPaymentMethod) {
            const paymentMethodText = selectedPaymentMethod.nextElementSibling.textContent.trim();
            message += `*Forma de Pagamento:* ${paymentMethodText}\n\n`;
        }
        
        // Adiciona dados de entrega √† mensagem
        message += `*-- Dados de Entrega --*\n`;
        message += `*Nome:* ${deliveryDetails.name}\n`;
        message += `*Endere√ßo:* ${deliveryDetails.street}, N¬∫ ${deliveryDetails.number}\n`;
        if (deliveryDetails.complement) {
            message += `*Complemento:* ${deliveryDetails.complement}\n`;
        }
        message += `*Bairro:* ${deliveryDetails.neighborhood}\n`;
        message += `*Cidade/UF:* ${deliveryDetails.city}/${deliveryDetails.state}\n`;
        message += `*CEP:* ${deliveryDetails.cep}`;


        const encodedMessage = encodeURIComponent(message);
        const url = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
        
        // Criar link tempor√°rio para evitar problemas com window.open
        const link = document.createElement('a');
        link.href = url;
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function openDeliveryModal() {
        deliveryModal.classList.remove('hidden');
        deliveryModal.classList.add('flex');
        const nameEl = document.getElementById('customerName');
        if (nameEl) nameEl.focus();
    }

    function closeDeliveryModal() {
        deliveryModal.classList.add('hidden');
        deliveryModal.classList.remove('flex');
    }

    // Success Modal Functions
    async function showSuccessModal(orderData) {
        const successModal = document.getElementById('successModal');
        const orderNumberText = document.getElementById('orderNumberText');
        const deliveryEstimateText = document.getElementById('deliveryEstimateText');
        const whatsappNoticeText = document.getElementById('whatsappNoticeText');
        const thankYouText = document.getElementById('thankYouText');
        const trackDeliveryLink = document.getElementById('trackDeliveryLink');
        const summaryBox = document.getElementById('successOrderSummary');
        const summaryItemsCount = document.getElementById('summaryItemsCount');
        const summaryTotal = document.getElementById('summaryTotal');

        // Fecha o drawer para evitar conflitos de stacking/transform
        closeCartDrawer();

        // Atualiza conte√∫do do overlay simples
        const orderId = (orderData && (orderData.order_id || (orderData.data && orderData.data.order && orderData.data.order.id)))
            ? (orderData.order_id || orderData.data.order.id)
            : 'N/A';
        orderNumberText.textContent = `Pedido #${orderId}`;
        const estimate = '45‚Äì60 min';
        deliveryEstimateText.textContent = `Estimativa de entrega: ${estimate}`;
        whatsappNoticeText.textContent = 'Voc√™ receber√° o resumo pelo WhatsApp em instantes';
        thankYouText.textContent = 'Obrigado pela prefer√™ncia! üíö';
        if (trackDeliveryLink) {
            trackDeliveryLink.href = `/status.html?id=${orderId}`;
            // Ajuste de cor conforme tema do sistema
            try {
                const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                trackDeliveryLink.classList.remove('bg-emerald-600','hover:bg-emerald-700','bg-emerald-500','hover:bg-emerald-600');
                trackDeliveryLink.classList.add(isDark ? 'bg-emerald-500 hover:bg-emerald-600' : 'bg-emerald-600 hover:bg-emerald-700');
            } catch (e) {}
        }

        // Buscar mini-resumo do pedido (itens/total) se dispon√≠vel
        if (summaryBox && orderId && orderId !== 'N/A') {
            try {
                const res = await fetch(`/api/order-status?order_id=${orderId}`);
                if (res.ok) {
                    const data = await res.json();
                    summaryItemsCount.textContent = Array.isArray(data.items) ? data.items.length : 0;
                    const total = (data.order && (data.order.total ?? data.order.subtotal)) || 0;
                    summaryTotal.textContent = `R$ ${Number(total).toFixed(2)}`;
                    summaryBox.classList.remove('hidden');
                }
            } catch (e) {
                // Mant√©m oculto em caso de falha
            }
        }

        // Exibe modal
        successModal.classList.remove('hidden');
        successModal.classList.add('flex');
        // Bloqueia scroll enquanto o modal est√° aberto
        document.body.style.overflow = 'hidden';
        // Sinaliza estado de modal aberto para bloquear intera√ß√µes abaixo
        document.body.classList.add('modal-open');
        // Neutraliza efeitos de will-change do toast enquanto o modal est√° ativo
        if (toastElement) {
            toastElement.classList.remove('will-change-transform');
            toastElement.style.willChange = 'auto';
            toastElement.style.pointerEvents = 'none';
        }
        
        // Anima√ß√£o de escala
        const modalContent = successModal.querySelector('div > div');
        setTimeout(() => {
            modalContent.style.transform = 'scale(1)';
        }, 50);
    }

    function closeSuccessModal() {
        const successModal = document.getElementById('successModal');
        const modalContent = successModal.querySelector('div > div');
        
        // Scale down animation
        modalContent.style.transform = 'scale(0.95)';
        
        setTimeout(() => {
            successModal.classList.add('hidden');
            successModal.classList.remove('flex');
            // Restaura scroll do body ap√≥s fechar o modal
            document.body.style.overflow = '';
            document.body.classList.remove('modal-open');
            // Restaura comportamento do toast
            if (toastElement) {
                toastElement.style.pointerEvents = '';
                toastElement.classList.add('will-change-transform');
                toastElement.style.willChange = '';
            }
        }, 200);
    }

    // Removido: fun√ß√£o de anima√ß√£o Lottie (substitu√≠da por overlay simples)

    function clearAddressForm() {
        document.getElementById('customerStreet').value = '';
        document.getElementById('customerNeighborhood').value = '';
        document.getElementById('customerCity').value = '';
        document.getElementById('customerState').value = '';
    }

    // Fun√ß√£o para mostrar o modal de confirma√ß√£o de limpeza do carrinho
    function showClearCartModal() {
        console.log('üóëÔ∏è showClearCartModal chamada!');
        const modal = document.getElementById('clearCartModal');
        console.log('üóëÔ∏è Modal encontrado:', modal);
        if (modal) {
            console.log('üóëÔ∏è Mostrando modal...');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
            
            // Adiciona anima√ß√£o de entrada
            const modalContent = modal.querySelector('div');
            if (modalContent) {
                modalContent.style.transform = 'scale(0.8)';
                modalContent.style.opacity = '0';
                
                setTimeout(() => {
                    modalContent.style.transform = 'scale(1)';
                    modalContent.style.opacity = '1';
                }, 10);
            }
            
            console.log('üóëÔ∏è Modal classes:', modal.className);
        } else {
            console.error('üóëÔ∏è Modal clearCartModal n√£o encontrado!');
        }
    }

    // Fun√ß√£o para esconder o modal de confirma√ß√£o
    function hideClearCartModal() {
        console.log('üóëÔ∏è hideClearCartModal chamada!');
        const modal = document.getElementById('clearCartModal');
        if (modal) {
            console.log('üóëÔ∏è Escondendo modal...');
            
            // Adiciona anima√ß√£o de sa√≠da
            const modalContent = modal.querySelector('div');
            if (modalContent) {
                modalContent.style.transform = 'scale(0.8)';
                modalContent.style.opacity = '0';
            }
            
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.style.overflow = '';
                
                // Restaura o estado inicial
                if (modalContent) {
                    modalContent.style.transform = 'scale(0.95)';
                    modalContent.style.opacity = '1';
                }
            }, 200);
        }
    }

    // Fun√ß√£o para limpar completamente o carrinho
    function clearCart() {
        console.log('üóëÔ∏è Iniciando limpeza do carrinho...');
        console.log('üóëÔ∏è Itens no carrinho antes da limpeza:', Object.keys(cart));
        console.log('üóëÔ∏è Objeto cart:', cart);
        
        // Adiciona anima√ß√£o de fade out aos itens do carrinho
        const cartItemsList = document.getElementById('cartItemsList');
        if (cartItemsList) {
            console.log('üóëÔ∏è Aplicando anima√ß√£o de fade out...');
            cartItemsList.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
            cartItemsList.style.opacity = '0';
            cartItemsList.style.transform = 'translateY(-10px)';
        }
        
        // Aguarda a anima√ß√£o antes de limpar
        setTimeout(() => {
            console.log('üóëÔ∏è Executando limpeza ap√≥s anima√ß√£o...');
            
            // Limpa o objeto cart completamente
            Object.keys(cart).forEach(key => {
                console.log('üóëÔ∏è Removendo item:', key, cart[key]);
                delete cart[key];
            });
            
            // For√ßa a limpeza completa do objeto cart
            for (let key in cart) {
                delete cart[key];
            }
            
            // Recria o objeto cart vazio
            cart = {};
            
            console.log('üóëÔ∏è Carrinho ap√≥s limpeza:', cart);
            console.log('üóëÔ∏è Chaves restantes:', Object.keys(cart));
            
            // Remove do localStorage
            try {
                localStorage.removeItem('cart');
                localStorage.setItem('cart', JSON.stringify({}));
                console.log('üóëÔ∏è localStorage limpo');
            } catch (e) {
                console.error('üóëÔ∏è Erro ao limpar localStorage:', e);
            }
            
            // Re-renderiza o carrinho
            renderCart();
            console.log('üóëÔ∏è Carrinho re-renderizado');
            
            // Atualiza o contador do carrinho
            updateCartCounter();
            console.log('üóëÔ∏è Contador atualizado');
            
            // Restaura o estilo do cartItemsList
            if (cartItemsList) {
                cartItemsList.style.opacity = '1';
                cartItemsList.style.transform = 'translateY(0)';
            }
            
            // Mostra toast de confirma√ß√£o
            showClearCartToast();
            
            console.log('üóëÔ∏è Carrinho limpo com sucesso!');
        }, 300);
    }

    // Fun√ß√£o para mostrar toast de carrinho limpo
    function showClearCartToast() {
        // Remove toast existente se houver
        const existingToast = document.querySelector('.clear-cart-toast');
        if (existingToast) {
            existingToast.remove();
        }

        // Cria o toast
        const toast = document.createElement('div');
        toast.className = 'clear-cart-toast fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-[104] transform translate-x-full transition-transform duration-300';
        toast.innerHTML = `
            <div class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3,6 5,6 21,6"></polyline>
                    <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                </svg>
                <span>Carrinho limpo!</span>
            </div>
        `;
        
        document.body.appendChild(toast);
        
        // Anima a entrada
        setTimeout(() => {
            toast.classList.remove('translate-x-full');
        }, 100);
        
        // Remove ap√≥s 3 segundos
        setTimeout(() => {
            toast.classList.add('translate-x-full');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }, 3000);
    }

    // Fun√ß√£o para atualizar o contador do carrinho
    function updateCartCounter() {
        const cartCount = getCartItemCount();
        const cartCountElement = document.getElementById('cartCount');
        if (cartCountElement) {
            cartCountElement.textContent = cartCount;
            cartCountElement.style.display = cartCount > 0 ? 'flex' : 'none';
            console.log('üî¢ Contador atualizado:', cartCount);
        } else {
            console.warn('‚ö†Ô∏è Elemento cartCount n√£o encontrado');
        }
    }

    function getSessionIdFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('sessao_id');
    }

    async function loadSession() {
        console.log('[DEBUG] loadSession() iniciada');
        sessionId = getSessionIdFromURL();
        console.log('[DEBUG] Session ID:', sessionId);
        if (!sessionId) {
            console.log('[DEBUG] Sem session ID, usando produtos padrao');
            return;
        }
        try {
            console.log('[DEBUG] Fazendo fetch para:', `${API_BASE}/api/produtos/${sessionId}`);
            const res = await fetch(`${API_BASE}/api/produtos/${sessionId}`);
            if (!res.ok) {
                console.error('[ERROR] Resposta nao OK:', res.status, res.statusText);
                return;
            }
            const data = await res.json();
            console.log('[DEBUG] Dados recebidos:', data);
            sessionPhone = data.cliente_telefone || null;
            const status = data.status;
            if (status === 'expirada' || status === 'finalizada') {
                openDeliveryModalBtn.disabled = true;
            }
            // Substitui os produtos locais pelos da sess√£o
            productsData.splice(0, productsData.length);
            data.produtos.forEach(p => {
                productsData.push({
                    id: String(p.id),
                    name: p.descricao,
                    description: p.apresentacao || p.categoria || p.descricao,
                    price: Number(p.preco),
                    imageUrl: p.imagem_url || (API_BASE + '/public/padrao.png')
                });
            });
            console.log('[DEBUG] Produtos carregados:', productsData.length);
        } catch (e) {
            console.error('[ERROR] Falha ao carregar sessao:', e);
        }
    }

    async function postSelection(deliveryDetails = null) {
        console.log('üîç [DEBUG] postSelection iniciado');
        console.log('üîç [DEBUG] sessionId:', sessionId);
        console.log('üîç [DEBUG] deliveryDetails:', deliveryDetails);
        
        if (!sessionId) {
            console.log('‚ùå [DEBUG] postSelection: sessionId n√£o encontrado');
            return false;
        }
        
        // Preparar dados dos produtos selecionados
        const produtos_selecionados = Object.values(cart).map(item => ({
            produto_id: Number(item.id.replace(/\D/g, '')) || Number(item.id),
            quantidade: item.quantity
        }));
        
        console.log('üîç [DEBUG] produtos_selecionados:', produtos_selecionados);

        // Obter forma de pagamento selecionada
        const selectedPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
        const formaPagamento = selectedPaymentMethod ? selectedPaymentMethod.value : null;
        
        console.log('üîç [DEBUG] formaPagamento:', formaPagamento);

        try {
            console.log('üîç [DEBUG] Iniciando chamada para API backend...');
            
            // 1. Registrar sele√ß√£o no backend (mant√©m funcionalidade existente)
            const res = await fetch(`${API_BASE}/api/produtos/${sessionId}/selecionar`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    produtos_selecionados,
                    cliente_telefone: sessionPhone || undefined,
                    forma_pagamento: formaPagamento
                })
            });
            
            console.log('üîç [DEBUG] Resposta da API backend:', res.status, res.statusText);
            
            if (!res.ok) {
                console.warn('‚ö†Ô∏è [DEBUG] Falha ao registrar sele√ß√£o no backend');
            } else {
                const backendResult = await res.json();
                console.log('üîç [DEBUG] Resultado do backend:', backendResult);
            }

            // 2. Enviar dados completos para webhook do n8n (se tiver dados de entrega)
            if (deliveryDetails) {
                console.log('üîç [DEBUG] Iniciando sendWebhookToN8n...');
                const ok = await sendWebhookToN8n(deliveryDetails, formaPagamento);
                console.log('üîç [DEBUG] Resultado do sendWebhookToN8n:', ok);
                return !!ok;
            }
            
            console.log('‚ùå [DEBUG] deliveryDetails n√£o fornecido');
            return false;
        } catch (e) {
            console.error('‚ùå [DEBUG] Erro em postSelection:', e);
            console.warn('Erro ao registrar sele√ß√£o no backend', e);
            throw e;
        }
    }

    async function sendWebhookToN8n(deliveryDetails, formaPagamento) {
        console.log('üîç [DEBUG] sendWebhookToN8n iniciado');
        console.log('üîç [DEBUG] deliveryDetails:', deliveryDetails);
        console.log('üîç [DEBUG] formaPagamento:', formaPagamento);
        
        try {
            // Calcular total do pedido
            let total = 0;
            const produtos = Object.values(cart).map(item => {
                const subtotal = item.price * item.quantity;
                total += subtotal;
                return {
                    id: item.id,
                    nome: item.name,
                    codigo: item.code || "",
                    descricao: item.description,
                    preco_unitario: item.price,
                    quantidade: item.quantity,
                    subtotal: subtotal
                };
            });
            
            console.log('üîç [DEBUG] produtos processados:', produtos);
            console.log('üîç [DEBUG] total calculado:', total);

            // Estruturar payload JSON completo para o novo sistema
            const webhookPayload = {
                cliente: {
                    nome: deliveryDetails.name,
                    telefone: sessionPhone || ""
                },
                entrega: {
                    cep: deliveryDetails.cep,
                    endereco: deliveryDetails.street,
                    numero: deliveryDetails.number,
                    complemento: deliveryDetails.complement || "",
                    bairro: deliveryDetails.neighborhood,
                    cidade: deliveryDetails.city,
                    estado: deliveryDetails.state
                },
                pagamento: {
                    forma_pagamento: formaPagamento,
                    valor_total: total
                },
                produtos: produtos
            };

            console.log('üì§ Enviando pedido para sistema independente:', webhookPayload);

            // Tentar primeiro o sistema independente (novo)
            try {
                console.log('üîç [DEBUG] Fazendo fetch para:', `${API_BASE}/api/process-order`);
                
                const independentResponse = await fetch(`${API_BASE}/api/process-order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(webhookPayload)
                });

                console.log('üîç [DEBUG] Status da resposta:', independentResponse.status);
                console.log('üîç [DEBUG] Headers da resposta:', [...independentResponse.headers.entries()]);

                const independentResult = await independentResponse.json();
                console.log('üì• Resposta do sistema independente:', independentResult);

                if (independentResponse.ok && independentResult.status === 'success') {
                    console.log('‚úÖ Pedido processado com sucesso pelo sistema independente');
                    showSuccessModal(independentResult);
                    return true;
                } else {
                    console.warn('‚ö†Ô∏è Falha ao processar pelo sistema independente:', independentResponse.status, independentResult);
                    alert('‚ö†Ô∏è N√£o foi poss√≠vel processar seu pedido. Tente novamente.');
                    return false;
                }
            } catch (independentError) {
                console.error('‚ùå Sistema independente indispon√≠vel:', independentError);
                console.error('‚ùå Stack trace:', independentError.stack);
                alert('‚ùå N√£o foi poss√≠vel processar seu pedido agora. Tente novamente em alguns minutos.');
                return false;
            }

            // N√£o usar n8n para processamento de pedidos
            return false;
        } catch (error) {
            console.error('‚ùå Erro ao processar pedido:', error);
            console.error('‚ùå Stack trace:', error.stack);
            alert('‚ùå Pedido confirmado! (Erro de conex√£o tempor√°rio)');
            return false;
        }
    }

    // --- Listeners de Eventos ---

    productListContainer.addEventListener('click', (event) => {
        // Verifica se o clique foi no bot√£o ou em seus elementos filhos
        const button = event.target.closest('.add-to-cart-btn');
        if (button) {
            event.preventDefault();
            event.stopPropagation();
            const productId = button.getAttribute('data-id');
            if (productId) {
                addToCart(productId);
            }
        }
    });
    
    // Fun√ß√£o para remover item com anima√ß√£o
    function removeItemWithAnimation(productId, itemElement) {
        console.log('üóëÔ∏è Iniciando remo√ß√£o animada do item:', productId);
        
        try {
            // Adiciona classe de anima√ß√£o de remo√ß√£o
            itemElement.classList.add('cart-item-removing');
            
            // Aguarda a anima√ß√£o completar antes de remover do DOM e estado
            setTimeout(() => {
                try {
                    // Remove do carrinho
                    delete cart[productId];
                    
                    // Salva no localStorage
                    saveCart();
                    
                    // Re-renderiza o carrinho
                    renderCart();
                    
                    // Atualiza o contador
                    updateCartCounter();
                    
                    console.log('‚úÖ Item removido com sucesso:', productId);
                } catch (error) {
                    console.error('‚ùå Erro ao remover item:', error);
                    
                    // Reverte a anima√ß√£o em caso de erro
                    itemElement.classList.remove('cart-item-removing');
                    itemElement.classList.add('cart-item-error');
                    
                    // Remove a classe de erro ap√≥s a anima√ß√£o
                    setTimeout(() => {
                        itemElement.classList.remove('cart-item-error');
                    }, 500);
                    
                    // Mostra toast de erro
                    showErrorToast('Erro ao remover item. Tente novamente.');
                }
            }, 300); // Dura√ß√£o da anima√ß√£o CSS
            
        } catch (error) {
            console.error('‚ùå Erro ao iniciar anima√ß√£o de remo√ß√£o:', error);
            showErrorToast('Erro ao remover item. Tente novamente.');
        }
    }
    
    // Fun√ß√£o para mostrar toast de erro
    function showErrorToast(message) {
        // Remove toast existente se houver
        const existingToast = document.getElementById('errorToast');
        if (existingToast) {
            existingToast.remove();
        }
        
        // Cria novo toast de erro
        const errorToast = document.createElement('div');
        errorToast.id = 'errorToast';
        errorToast.className = 'fixed bottom-4 right-4 error-toast rounded-lg shadow-lg p-4 z-[1002] transform translate-x-full transition-transform duration-300';
        errorToast.innerHTML = `
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
                <span class="font-medium">${message}</span>
            </div>
        `;
        
        document.body.appendChild(errorToast);
        
        // Anima entrada
        setTimeout(() => {
            errorToast.style.transform = 'translateX(0)';
        }, 10);
        
        // Remove ap√≥s 3 segundos
        setTimeout(() => {
            errorToast.style.transform = 'translateX(full)';
            setTimeout(() => {
                if (errorToast.parentNode) {
                    errorToast.remove();
                }
            }, 300);
        }, 3000);
    }

    cartItemsContainer.addEventListener('click', (event) => {
        const target = event.target;
        const productId = target.getAttribute('data-id');
        if (!productId) return;

        if (target.classList.contains('increase-qty-btn')) {
            updateQuantity(productId, 1);
        } else if (target.classList.contains('decrease-qty-btn')) {
            updateQuantity(productId, -1);
        } else if (target.classList.contains('remove-item-btn')) {
            // Encontra o elemento do item do carrinho
            const itemElement = target.closest('.cart-item');
            if (itemElement) {
                removeItemWithAnimation(productId, itemElement);
            } else {
                // Fallback para remo√ß√£o direta se n√£o encontrar o elemento
                delete cart[productId];
                saveCart();
                renderCart();
            }
        }
    });
    
    openDeliveryModalBtn.addEventListener('click', openDeliveryModal);
    cancelDeliveryBtn.addEventListener('click', closeDeliveryModal);
    
    // Success Modal Event Listeners
    const closeSuccessModalBtn = document.getElementById('closeSuccessModal');
    if (closeSuccessModalBtn) {
        closeSuccessModalBtn.addEventListener('click', closeSuccessModal);
    }
    
    deliveryForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        console.log('üîç [DEBUG] Formul√°rio de entrega submetido');
        
        const deliveryDetails = {
            name: document.getElementById('customerName').value.trim(),
            cep: document.getElementById('customerCep').value.trim(),
            street: document.getElementById('customerStreet').value.trim(),
            number: document.getElementById('customerNumber').value.trim(),
            complement: document.getElementById('customerComplement').value.trim(),
            neighborhood: document.getElementById('customerNeighborhood').value.trim(),
            city: document.getElementById('customerCity').value.trim(),
            state: document.getElementById('customerState').value.trim()
        };
        
        console.log('üîç [DEBUG] Dados de entrega coletados:', deliveryDetails);
        
        // Valida√ß√µes adicionais: CEP (8 d√≠gitos) e N√∫mero (apenas d√≠gitos)
        const cepDigits = deliveryDetails.cep.replace(/\D/g, '');
        console.log('üîç [DEBUG] CEP processado:', cepDigits, 'Tamanho:', cepDigits.length);
        
        if (cepDigits.length !== 8) {
            console.log('‚ùå [DEBUG] Erro: CEP inv√°lido');
            alert('CEP deve ter 8 d√≠gitos.');
            return;
        }
        if (!/^\d+$/.test(deliveryDetails.number)) {
            console.log('‚ùå [DEBUG] Erro: N√∫mero inv√°lido');
            alert('N√∫mero deve conter apenas d√≠gitos.');
            return;
        }

        // Valida√ß√£o da forma de pagamento
        const selectedPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
        console.log('üîç [DEBUG] Forma de pagamento selecionada:', selectedPaymentMethod?.value);
        
        if (!selectedPaymentMethod) {
            console.log('‚ùå [DEBUG] Erro: Nenhuma forma de pagamento selecionada');
            alert('Por favor, selecione uma forma de pagamento.');
            return;
        }

        console.log('üîç [DEBUG] Valida√ß√µes b√°sicas passaram');
        
        if (deliveryDetails.name && deliveryDetails.street && deliveryDetails.number) {
            console.log('üîç [DEBUG] Campos obrigat√≥rios preenchidos');
            
            try {
                // Evita erro gen√©rico quando a p√°gina foi aberta sem ?sessao_id=
                if (!sessionId) {
                    console.log('‚ùå [DEBUG] Erro: Sess√£o n√£o identificada');
                    alert('Sess√£o n√£o identificada. Abra o cat√°logo pelo link com "?sessao_id=..." ou gere uma sess√£o em /api/demo/criar-sessao.');
                    return;
                }
                
                console.log('üîç [DEBUG] SessionId encontrado:', sessionId);
                console.log('üîç [DEBUG] Iniciando postSelection...');
                
                // Adicionar indicador visual de carregamento
                const submitBtn = event.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Processando...';
                
                const sucesso = await postSelection(deliveryDetails);
                console.log('üîç [DEBUG] Resultado do postSelection:', sucesso);
                
                // Restaurar bot√£o
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                
                if (sucesso) {
                    console.log('‚úÖ [DEBUG] Pedido finalizado com sucesso');
                    closeDeliveryModal();
                    deliveryForm.reset();
                    // Limpar carrinho apenas quando pedido confirmado
                    cart = {};
                    saveCart();
                    renderCart();
                } else {
                    console.log('‚ùå [DEBUG] Falha ao confirmar pedido');
                    alert('N√£o foi poss√≠vel confirmar o pedido. Tente novamente.');
                }
            } catch (error) {
                console.error('‚ùå [DEBUG] Erro durante finaliza√ß√£o:', error);
                
                // Restaurar bot√£o em caso de erro
                const submitBtn = event.target.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Confirmar Pedido';
                
                alert('Erro ao finalizar pedido. Tente novamente.');
            }
        } else {
            console.log('‚ùå [DEBUG] Campos obrigat√≥rios n√£o preenchidos');
            console.log('Nome:', deliveryDetails.name);
            console.log('Rua:', deliveryDetails.street);
            console.log('N√∫mero:', deliveryDetails.number);
        }
    });

    cepInput.addEventListener('input', (e) => {
        let value = e.target.value;
        value = value.replace(/\D/g, "");
        value = value.replace(/^(\d{5})(\d)/, "$1-$2");
        e.target.value = value;
    });

    cepInput.addEventListener('blur', async (e) => {
        const cep = e.target.value.replace(/\D/g, '');
        if (cep.length !== 8) {
            clearAddressForm();
            return;
        }

        cepLoading.classList.remove('hidden');
        clearAddressForm();

        try {
            const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            const data = await response.json();

            if (data.erro) {
                alert('CEP n√£o encontrado.');
                return;
            }

            document.getElementById('customerStreet').value = data.logradouro;
            document.getElementById('customerNeighborhood').value = data.bairro;
            document.getElementById('customerCity').value = data.localidade;
            document.getElementById('customerState').value = data.uf;
            document.getElementById('customerNumber').focus();

        } catch (error) {
            alert('N√£o foi poss√≠vel buscar o CEP. Tente novamente.');
        } finally {
            cepLoading.classList.add('hidden');
        }
    });

    cartBtn.addEventListener('click', toggleCart);
    closeCartBtn.addEventListener('click', toggleCart);
    cartOverlay.addEventListener('click', toggleCart);
    
    // Event listeners para limpar carrinho
    const clearCartBtn = document.getElementById('clearCartBtn');
    const cancelClearCartBtn = document.getElementById('cancelClearCart');
    const confirmClearCartBtn = document.getElementById('confirmClearCart');
    
    if (clearCartBtn) {
        console.log('üóëÔ∏è Event listener adicionado ao clearCartBtn');
        clearCartBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('üóëÔ∏è Clique no clearCartBtn detectado!');
            console.log('üóëÔ∏è Bot√£o desabilitado?', clearCartBtn.disabled);
            console.log('üóëÔ∏è Itens no carrinho:', Object.keys(cart).length);
            
            if (!clearCartBtn.disabled && Object.keys(cart).length > 0) {
                console.log('üóëÔ∏è Iniciando limpeza direta do carrinho...');
                clearCart();
            } else {
                console.log('üóëÔ∏è Bot√£o est√° desabilitado ou carrinho vazio');
            }
        });
    } else {
        console.error('üóëÔ∏è clearCartBtn n√£o encontrado!');
    }
    
    if (cancelClearCartBtn) {
        cancelClearCartBtn.addEventListener('click', hideClearCartModal);
    }
    
    if (confirmClearCartBtn) {
        confirmClearCartBtn.addEventListener('click', clearCart);
    }
    
    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && !cartDrawer.classList.contains('translate-x-full')) {
            toggleCart();
        }
        if (event.key === 'Escape' && !deliveryModal.classList.contains('hidden')) {
            closeDeliveryModal();
        }
        // Fechar modal de limpar carrinho com ESC
        if (event.key === 'Escape' && !document.getElementById('clearCartModal').classList.contains('hidden')) {
            hideClearCartModal();
        }
    });

    // Header hide/show and scroll to top functionality
    function handleScroll() {
        const currentScrollY = window.scrollY;
        
        // Header hide/show logic
        if (currentScrollY > lastScrollY && currentScrollY > 100) {
            // Scrolling down
            if (!isScrollingDown) {
                isScrollingDown = true;
                mainHeader.classList.remove('header-visible');
                mainHeader.classList.add('header-hidden');
            }
        } else if (currentScrollY < lastScrollY) {
            // Scrolling up
            if (isScrollingDown) {
                isScrollingDown = false;
                mainHeader.classList.remove('header-hidden');
                mainHeader.classList.add('header-visible');
            }
        }
        
        // Scroll to top FAB visibility
        if (currentScrollY > 300) {
            scrollToTopFab.classList.add('visible');
        } else {
            scrollToTopFab.classList.remove('visible');
        }
        
        lastScrollY = currentScrollY;
    }

    // Throttle scroll events for better performance
    let scrollTimeout;
    window.addEventListener('scroll', () => {
        if (scrollTimeout) {
            clearTimeout(scrollTimeout);
        }
        scrollTimeout = setTimeout(handleScroll, 10);
    });

    // Scroll to top FAB click handler
    scrollToTopFab.addEventListener('click', () => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    document.addEventListener('DOMContentLoaded', async () => {
        // Carregar carrinho salvo
        try {
            const stored = localStorage.getItem('cart');
            if (stored) {
                const parsed = JSON.parse(stored);
                if (parsed && typeof parsed === 'object') {
                    cart = parsed;
                }
            }
        } catch (e) {}

        await loadSession();
        renderProducts();
        renderCart();
        updateCartCounter();
        
        // Garantir que o bot√£o de limpar carrinho seja inicializado corretamente
        const clearCartBtn = document.getElementById('clearCartBtn');
        if (clearCartBtn) {
            const hasItems = Object.keys(cart).length > 0;
            clearCartBtn.disabled = !hasItems;
            console.log('üóëÔ∏è Bot√£o limpar carrinho inicializado:', hasItems ? 'habilitado' : 'desabilitado');
        }

        const searchInputEl = document.getElementById('searchInput');
        const headerSearchInputEl = document.getElementById('headerSearchInput');
        
        // Sincronizar campos de busca
        function syncSearchFields(sourceField, targetField) {
            if (sourceField && targetField) {
                targetField.value = sourceField.value;
            }
        }
        
        if (searchInputEl) {
            const handleSearch = debounce(() => {
                syncSearchFields(searchInputEl, headerSearchInputEl);
                renderProducts();
            }, 200);
            searchInputEl.addEventListener('input', handleSearch);
        }
        
        if (headerSearchInputEl) {
            const handleHeaderSearch = debounce(() => {
                syncSearchFields(headerSearchInputEl, searchInputEl);
                renderProducts();
            }, 200);
            headerSearchInputEl.addEventListener('input', handleHeaderSearch);
        }
        
        // --- FUNCIONALIDADE DO CARROSSEL DE BANNERS ---
        let currentSlide = 0;
        const slides = document.querySelectorAll('.banner-slide');
        const totalSlides = slides.length;
        let autoSlideInterval;
        
        // Fun√ß√£o para mostrar slide espec√≠fico
        function showSlide(index) {
            // Remove classes ativas de todos os slides
            slides.forEach((slide, i) => {
                slide.classList.remove('active', 'prev');
                if (i === index) {
                    slide.classList.add('active');
                } else if (i < index) {
                    slide.classList.add('prev');
                }
            });
            
            currentSlide = index;
        }
        
        // Fun√ß√£o para pr√≥ximo slide
        function nextSlide() {
            const next = (currentSlide + 1) % totalSlides;
            showSlide(next);
        }
        
        // Fun√ß√£o para slide anterior
        function prevSlide() {
            const prev = (currentSlide - 1 + totalSlides) % totalSlides;
            showSlide(prev);
        }
        
        // Auto-play do carrossel
        function startAutoSlide() {
            autoSlideInterval = setInterval(nextSlide, 5000); // Muda a cada 5 segundos
        }
        
        function stopAutoSlide() {
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
            }
        }
        
        // Event listeners para navega√ß√£o
        const nextBtn = document.getElementById('nextBanner');
        const prevBtn = document.getElementById('prevBanner');
        
        if (nextBtn) {
            nextBtn.addEventListener('click', () => {
                stopAutoSlide();
                nextSlide();
                startAutoSlide(); // Reinicia o auto-play
            });
        }
        
        if (prevBtn) {
            prevBtn.addEventListener('click', () => {
                stopAutoSlide();
                prevSlide();
                startAutoSlide(); // Reinicia o auto-play
            });
        }
        
        // Pausar auto-play quando mouse estiver sobre o carrossel
        const carousel = document.getElementById('bannerCarousel');
        if (carousel) {
            carousel.addEventListener('mouseenter', stopAutoSlide);
            carousel.addEventListener('mouseleave', startAutoSlide);
        }
        
        // Suporte para navega√ß√£o por teclado
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                stopAutoSlide();
                prevSlide();
                startAutoSlide();
            } else if (e.key === 'ArrowRight') {
                stopAutoSlide();
                nextSlide();
                startAutoSlide();
            }
        });
        
        // Suporte para touch/swipe em dispositivos m√≥veis
        let touchStartX = 0;
        let touchEndX = 0;
        
        if (carousel) {
            carousel.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            carousel.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
        }
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                stopAutoSlide();
                if (diff > 0) {
                    nextSlide(); // Swipe left - pr√≥ximo slide
                } else {
                    prevSlide(); // Swipe right - slide anterior
                }
                startAutoSlide();
            }
        }
        
        // Inicializar carrossel
        if (slides.length > 0) {
            showSlide(0);
            startAutoSlide();
        }
        
        
        // --- FUNCIONALIDADE DO SEARCH MOBILE ---
        const mobileSearchToggle = document.getElementById('mobileSearchToggle');
        const mobileSearchBar = document.getElementById('mobileSearchBar');
        const mobileSearchInput = document.getElementById('mobileSearchInput');
        const desktopSearchInput = document.getElementById('searchInput');
        
        if (mobileSearchToggle && mobileSearchBar) {
            mobileSearchToggle.addEventListener('click', () => {
                mobileSearchBar.classList.toggle('hidden');
                if (!mobileSearchBar.classList.contains('hidden')) {
                    setTimeout(() => mobileSearchInput.focus(), 100);
                }
            });
        }
        
        // Sincronizar campos de busca e aplicar filtro com debounce
        if (mobileSearchInput && desktopSearchInput) {
            const handleMobileSearch = debounce(() => {
                // Mant√©m os campos sincronizados
                desktopSearchInput.value = mobileSearchInput.value;
                // Atualiza a lista de produtos
                renderProducts();
            }, 200);

            mobileSearchInput.addEventListener('input', handleMobileSearch);

            const handleDesktopMirror = debounce(() => {
                mobileSearchInput.value = desktopSearchInput.value;
            }, 200);
            desktopSearchInput.addEventListener('input', handleDesktopMirror);
        }
        
        // Performance optimizations
        // Lazy load images
        const lazyImages = document.querySelectorAll('img[data-src]');
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                    imageObserver.unobserve(img);
                }
            });
        });
        
        lazyImages.forEach(img => imageObserver.observe(img));
        
        // Debounce scroll events for better performance
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            if (scrollTimeout) {
                clearTimeout(scrollTimeout);
            }
            scrollTimeout = setTimeout(() => {
                // Handle scroll events here if needed
            }, 16); // ~60fps
        }, { passive: true });
        
        // Optimize touch events
        document.addEventListener('touchstart', () => {}, { passive: true });
        document.addEventListener('touchmove', () => {}, { passive: true });
        
        // Preload critical resources on interaction
        let interactionStarted = false;
        const startInteraction = () => {
            if (!interactionStarted) {
                interactionStarted = true;
                // Preload additional resources here if needed
            }
        };
        
        document.addEventListener('touchstart', startInteraction, { once: true, passive: true });
        document.addEventListener('mousedown', startInteraction, { once: true, passive: true });
        
    });
    </script>
</body>
</html>

